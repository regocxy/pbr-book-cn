# 蒙特卡洛积分(Monte Carlo Intergration)

原文 | [Monte Carlo Intergration](http://www.pbr-book.org/3ed-2018/Monte_Carlo_Integration.html)

在介绍辐射积分之前，我们首先要为求解光散射积分方程奠定基础。这些方程通常是无法解析的，所以我们要转用数值的方法计算。虽然标准的数值积分技术，如梯形积分(Trapezoidal)或高斯求积(Gaussian)，在求解低维光滑积分时非常有效，但它们对高维不连续积分的收敛速度较慢，而这些积分在渲染中很常见。

蒙特卡洛数值积分是解决这类问题的方法之一， 它使用随机数去估算收敛速度与被积函数的维度无关的积分。在本章中，我们将复习概率论中的重要概念，并为使用蒙特卡洛积分估算渲染中的关键积分奠定基础。

合理地使用随机数已经彻底改变了算法设计领域。随机算法大致分为两类：拉斯维加斯(Las Vegas)和蒙特卡洛(Monte Carlo)。拉斯维加斯算法是一种随机选择但最终得到唯一正确解的随机算法（例如在快速排序中，虽然随机选择数组中的一个数作为基准，但排序结果都是一样的），而蒙特卡洛算法则是在不同选择下得到不同的结果，但平均值是正确的随机算法。因此，通过对蒙特卡洛算法的几次运行结果求均值（在相同的输入条件下），就有可能找到一个统计学上非常接近真实答案的结果。Motwani和Raghavan(1995)对随机算法写过一篇优秀的介绍。

蒙特卡洛积分是一种使用随机采样来估算积分值的方法。它的一个非常有用的性质是，为了估计某个函数在某个定义域内的积分，人们只需在这个定义域内随机地找一些采样点计算被积函数$f(x)$的值再把所有采样点的函数值求平均就可得到该积分$\int f(x)dx$的估计值。这种性质不仅使蒙特卡洛积分易于实现，而且使该方法适用于各种各样的被积函数，包括那些不连续的被积函数。

渲染中出现的很多积分是很难或者是不可能被直接计算出来的。比如，根据式(5.9)计算某一表面某一点的反射光的强度，我们必须对入射光强与单位球上的BSDF的乘积进行积分。如何求解目前尚不清楚：在现实场景中，由于物体可见性的复杂且难于预测，入射光函数几乎从来没有以闭函数的形式出现过。

即使入射光函数是闭函数，通常也不可能得到解析形式的积分。蒙特卡洛积分使估算反射辐射成为可能，只需在球面上选择一组方向，计算沿这些方向的入射辐射与BSDF的加权乘积即可。于是任何的BSDFs、光源的描述和场景几何都变得很容易处理，只需要在任意点对这些被积函数进行估算就好了。

蒙特卡洛积分主要的缺点是如果使用样本去估算积分，算法的收敛速度为$O(n^{-1/2})$。换言之，要将误差减少一半，就需要估算四倍多的样本。使用蒙特卡洛积分进行图像合成具有昂贵的计算成本。在图像中，蒙特卡洛的失真表现为噪点随机地太亮或太暗。目前，图形学中对蒙特卡洛的研究，都是尽可能地减少这种误差同时尽量减少额外样本的数量。

